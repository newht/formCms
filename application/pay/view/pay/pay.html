<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>教育报名系统</title>
	<link rel="stylesheet" href="/static/layui/css/layui.css">
	<link rel="stylesheet" href="/static/user/css/indexTable.css">
	<link rel="stylesheet" href="/my-control/css/FMulSelectUI.min.css">
	<style>
        .info{border: 0}
        .infoTitle{border-bottom: 1px solid black;margin-bottom: 15px;padding-left: 5px}
        .payinfo{height: 100px;;text-align: left;font-size: 15px;padding: 0 10px;}
        .paynumber{padding: 5px}
        .paynumber span:first-child{
            color: #acacac
        }
	</style>
</head>
<body>
    <div class="max">
        {include file='public/logo'}
        <div class="info">
            <div class="infoTitle">
                订单支付
            </div>
            <div style="" id="layeropen" >
                <div class="payinfo">
                    <div class="paynumber">
                        <span>报名项目：</span><span>{$data.fname}</span>
                    </div>
                    <div class="paynumber">
                        <span>订单编号：</span><span>{$data.order_id}</span>
                    </div>
                    <div class="paynumber">
                        <span>应付金额：</span><span>{$data.money}元</span>
                    </div>
                </div>
                <div style="text-align: center">
                    <img src="/createqrcode?qr_url={$data.pay_info.code_url}" alt="" width="200" height="200" >
                    <div>
                        <img src="/static/images/payexplain.png" width="200" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="/static/jquery.min.js"></script>
<script type="text/javascript" src="/my-control/javascript/FMulSelectUI.min.js"></script>
<script type="text/javascript" src="/static/layui/layui.js"></script>
<script>
    layui.use('layer',function () {
        let layer = layui.layer;
    });

    let payindex = 0;

    function layerclose() {
        if (payindex < 240) {
            $.ajax({
                url: "/pay/getorderstatus",
                type: "post",
                dataType: "json",
                data: {orderid: "{$data.order_id}"},
                success: function (res) {
                    console.log(res);
                    if (res === 1) {
                        layer.close(layer.index);
                        layer.open({
                            content: '缴费成功', icon: 1, yes: function () {
                                location.href = "/user/gorecording"
                            }
                        })
                    } else {
                        console.log(payindex);
                        payindex += 1;
                        setTimeout(layerclose, 2000)
                    }
                }
            })
        }
    }

    setTimeout(layerclose,2000);

</script>
</html>
